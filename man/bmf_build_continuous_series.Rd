% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/processing.R
\name{bmf_build_continuous_series}
\alias{bmf_build_continuous_series}
\title{Build a continuous futures series with front/next rolls}
\usage{
bmf_build_continuous_series(
  ticker_root,
  roll_days_before_expiry = 20,
  clamp_ratio = c(0.6, 1.6),
  type = c("fwd_rt", "panama"),
  roll_type = c("days_before_roll", "windsor_log_spread", "regression"),
  adjusted = TRUE,
  single_xts = TRUE,
  debug = FALSE,
  everything = FALSE,
  data_dir = NULL,
  which = c("cache", "data", "config"),
  source = c("agg", "sm_api"),
  include_older = TRUE,
  maturities = "all"
)
}
\arguments{
\item{ticker_root}{Commodity root symbol (e.g. `"DI1"` or `"WIN"`).}

\item{roll_days_before_expiry}{Number of business days before the estimated
maturity to roll into the next contract (default: 20).}

\item{clamp_ratio}{Lower and upper bounds for the ratio applied at roll
seams when back-adjusting prices.}

\item{type}{Adjustment style applied to the stitched chain. `"fwd_rt"`
(forward-ratio) multiplies the ratio through to subsequent contracts so the
most recent prices remain untouched, while `"panama"` (classic Panama style)
scales historical segments backward so the oldest leg is preserved and
newer legs are shifted.}

\item{roll_type}{How to estimate the price ratio at roll seams. Accepts one
of `"days_before_roll"` (median overlap of price ratios close to the
roll), `"windsor_log_spread"` (median of winsorised log price spreads),
`"regression"` (OLS slope of the overlapping prices), or a custom function
with signature `(sym_vec, dates, lst_xts, seam_idx, clamp_ratio)` returning
numeric ratios.}

\item{adjusted}{When `TRUE`, return the back-adjusted continuous series;
otherwise the unadjusted (stitched) series is returned.}

\item{single_xts}{If `TRUE`, return a single xts object; when `FALSE`, return
a named list containing the series.}

\item{debug}{If `TRUE`, emit summary information about cumulative and
annualised returns for the continuous series.}

\item{everything}{When `TRUE`, return a list containing the aggregate data,
the unadjusted series, the adjusted series, and the daily contract table.}

\item{data_dir}{Optional directory containing cached files for `ticker_root`.}

\item{which}{Storage location passed to [tools::R_user_dir()] when
`data_dir` is `NULL`.}

\item{source}{Data source to build the series from: `"agg"` uses
[bmf_get_aggregate()] while `"sm_api"` attempts to call `sm_get_data()`
(when available) and falls back to the aggregate cache with a warning.}

\item{include_older}{When `TRUE`, legacy contracts whose symbols use
Portuguese month abbreviations (e.g. `"BGIABR1"`) are normalised to their
modern equivalents so they participate in the roll chain. Set to `FALSE`
to keep only modern `"BGIZ01"`-style contracts.}

\item{maturities}{Optional vector of month codes (e.g. `c("F", "U")`) to
restrict the chain to specific maturities. Use `"all"` (default) to keep
every available contract month.}
}
\value{
By default, invisibly returns an xts object. When `single_xts` is
  `FALSE`, returns a named list containing the requested series; when
  `everything` is `TRUE`, returns a list with the aggregate data, the
  unadjusted chain, the adjusted chain, and the daily contract metadata.
}
\description{
Construct a continuous daily series for a futures ticker root by rolling
from the front contract into the next contract a fixed number of business
days before the estimated maturity.
}
\details{
The function automatically merges legacy naming conventions from the
  B3 bulletins. Portuguese month suffixes are mapped to standard CME-style
  month codes when `include_older = TRUE`, and ticker-root aliases (such as
  the historical `"ICN"` commodity root for what is now traded as `"CCM"` or
  `"BOI"` for `"BGI"`) are consolidated before the roll logic runs. This keeps
  historical data continuous through renames without requiring manual
  preprocessing.
}
